<!DOCTYPE html>
<html lang="fr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{layout :: head('Détail de l’événement')}"></head>

<body class="bg-light">

<div th:replace="~{layout :: navbar}"></div>

<main class="container py-5 mt-4">

    <div th:if="${param.success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>Votre inscription a été validée avec succès !
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>Impossible de s'inscrire (déjà inscrit ou complet).
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="text-center mb-5">
        <h2 class="text-primary fw-bold display-5" th:text="${evenement.titre}">
            Titre de l’événement
        </h2>
        <p class="text-muted lead">
            Organisé par
            <strong th:if="${evenement.clubId != null}"
                    class="text-dark"
                    th:text="'Club ' + ${evenement.nomClub}">
            </strong>
            <strong th:if="${evenement.clubId == null}"
                    class="text-dark">
                Administration ENSAM
            </strong>
        </p>
    </div>

    <div class="row g-5">

        <div class="col-md-6">
            <img th:src="@{${evenement.imagePath != null ? evenement.imagePath : '/images/event-default.jpg'}}"
                 class="img-fluid rounded-3 shadow-lg w-100"
                 style="object-fit: contain; max-height: 400px;"
                 alt="Image Événement">
        </div>

        <div class="col-md-6">

            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body p-4">
                    <h4 class="card-title text-primary fw-bold mb-4">
                        <i class="fas fa-info-circle me-2"></i>Informations
                    </h4>

                    <div class="mb-3">
                        <i class="far fa-calendar-alt text-secondary me-2"></i><strong>Date de début :</strong><br>
                        <span class="ms-4 text-dark"
                              th:text="${#temporals.format(evenement.dateDebut, 'dd MMMM yyyy à HH:mm')}"></span>
                    </div>

                    <div class="mb-3" th:if="${evenement.dateFin}">
                        <i class="far fa-calendar-times text-secondary me-2"></i><strong>Date de fin :</strong><br>
                        <span class="ms-4 text-dark"
                              th:text="${#temporals.format(evenement.dateFin, 'dd MMMM yyyy à HH:mm')}"></span>
                    </div>

                    <div class="mb-3">
                        <i class="fas fa-map-marker-alt text-secondary me-2"></i><strong>Lieu :</strong><br>
                        <span class="ms-4 text-dark" th:text="${evenement.localisation}"></span>
                    </div>

                    <div class="mb-3">
                        <i class="fas fa-eye text-secondary me-2"></i><strong>Visibilité :</strong><br>
                        <span th:class="'ms-4 badge ' +
                            (${evenement.visibiliteEvenement.name() == 'PUBLIC'} ? 'bg-success' : 'bg-info text-dark')"
                              th:text="${evenement.visibiliteEvenement}">
                        </span>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold text-dark mb-3">À propos de cet événement</h5>
                    <p class="text-muted" style="white-space: pre-wrap;" th:text="${evenement.description}">
                        Aucune description fournie.
                    </p>
                </div>
            </div>

            <div class="d-flex gap-3 mt-4">

                <a sec:authorize="isAnonymous()" th:href="@{/login}" class="btn btn-primary btn-lg px-4 shadow-sm">
                    <i class="fas fa-sign-in-alt me-2"></i>Se connecter pour s'inscrire
                </a>

                <form sec:authorize="isAuthenticated()"
                      th:action="@{/events/{id}/register(id=${evenement.id})}"
                      method="post">
                    <button type="submit" class="btn btn-success btn-lg px-4 shadow-sm">
                        <i class="fas fa-user-plus me-2"></i>Je participe !
                    </button>
                </form>

                <a th:href="@{/events}" class="btn btn-outline-secondary btn-lg px-4">
                    Retour
                </a>
            </div>

        </div>
    </div>

</main>

<div th:replace="~{layout :: footer}"></div>

</body>
</html>